{% extends 'base.html' %}

{% block content %}
<h2 class="text-2xl md:text-3xl font-semibold mb-4 text-gray-800 text-center">
  ЁЯТ╝ Salary Summary List
</h2>

<div class="mt-4 text-right">
  {% if summaries %}
    <a href="{% url 'salary_summary_pdf' %}?month={{ selected_month }}&department={{ selected_department_id }}&employee={{ selected_employee_id }}"
       class="inline-flex items-center bg-green-600 text-white px-4 py-2 rounded-md shadow hover:bg-green-700 transition duration-150"
       target="_blank">
       ЁЯУД Export PDF
    </a>
  {% else %}
    <button class="inline-flex items-center bg-gray-300 text-gray-600 px-4 py-2 rounded-md shadow cursor-not-allowed" disabled>
       ЁЯУД Export PDF (No Data)
    </button>
  {% endif %}
</div>




<form method="get" class="bg-white p-6 rounded-lg shadow-md mb-6">
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

    <!-- Month Selector -->
    <div>
      <label for="month" class="block text-sm font-medium text-gray-700 mb-1">Select Month:</label>
      <input type="month" id="month" name="month" value="{{ selected_month }}"
             class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
    </div>

    <!-- Department Selector -->
    <div>
      <label for="department" class="block text-sm font-medium text-gray-700 mb-1">Select Department:</label>
      <select id="department" name="department"
              class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
        <option value="">All Departments</option>
        {% for dept in departments %}
          <option value="{{ dept.id }}" {% if dept.id|stringformat:"s" == selected_department %}selected{% endif %}>
            {{ dept.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Employee Selector -->
    <div>
      <label for="employee" class="block text-sm font-medium text-gray-700 mb-1">Select Employee:</label>
      <select id="employee" name="employee"
              class="w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 px-3 py-2">
        <option value="">All Employees</option>
        {% for emp in employees %}
          <option value="{{ emp.id }}" {% if emp.id|stringformat:"s" == selected_employee %}selected{% endif %}>
            {{ emp.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Submit Button -->
    <div class="flex items-end">
      <button type="submit"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded-md transition shadow">
        ЁЯФН Show Report
      </button>
    </div>

  </div>
</form>


{% if summaries %}
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
    <thead class="bg-gray-100">
        <tr>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">#</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Employee</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Month</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Base Salary</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Bank Transfer</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Cash Amount</th>
            
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Present</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Leave</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Absent</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Weekly Off</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Public Holidays</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Late Time</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Over Time</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Total Work</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Expected Work</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Diff</th>
            
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Final Salary</th>
            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase border border-gray-300">Payable Cash</th> <!-- Payable Cash ржПржЦрж╛ржирзЗ -->
        </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
        {% for s in summaries %}
        <tr>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ forloop.counter }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.employee.name }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.month }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">рз│ {{ s.base_salary }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">рз│ {{ s.bank_transfer }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">рз│ {{ s.cash_amount }}</td>
            
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.present_days }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.leave_days }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.absent_days }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.weekly_off_days }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.holiday_days }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.late_time }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.over_time }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.total_work_hours }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.expected_work_hours }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300">{{ s.work_time_difference }}</td>
            
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300 font-semibold text-green-700 text-right">рз│ {{ s.final_salary }}</td>
            <td class="px-4 py-2 whitespace-nowrap border border-gray-300 font-semibold text-red-700 text-right">рз│ {{ s.payable_cash }}</td> <!-- Payable Cash ржПржЦрж╛ржирзЗ -->
        </tr>
        {% endfor %}
    </tbody>

    <tfoot class="bg-gray-100 font-semibold">
        <tr>
            <td colspan="3" class="px-4 py-2 border border-gray-300 text-right">Basic Salary Total:</td>
            <td class="px-4 py-2 border border-gray-300 text-blue-700 font-bold">рз│ {{ total_base_salary }}</td>
            
            <td class="px-4 py-2 border border-gray-300 text-blue-700 font-bold">рз│ {{ total_bank_transfer }}</td>
            <td class="px-4 py-2 border border-gray-300 text-blue-700 font-bold">рз│ {{ total_cash_amount }}</td>
            <td colspan="1"></td> <!-- ржПржЦрж╛ржирзЗ ржПржХржЯрзБ ржЦрж╛рж▓рж┐ рж╕рзНржкрзЗрж╕ ржжрж┐рзЯрзЗ ржжрж┐рж▓рж╛ржо -->
            
            <td colspan="5"></td>
            
            <td colspan="1" class="px-4 py-2 border border-gray-300 text-right">Difference:</td>
            <td class="px-4 py-2 border border-gray-300 font-bold
                {% if total_salary_difference > 0 %}
                    text-green-700
                {% elif total_salary_difference < 0 %}
                    text-red-600
                {% else %}
                    text-gray-700
                {% endif %}
            ">
                рз│ {{ total_salary_difference }}

                {% if total_salary_difference > 0 %}
                    <span class="ml-2 text-green-600 font-normal text-xs">(Extra Salary Paid)</span>
                {% elif total_salary_difference < 0 %}
                    <span class="ml-2 text-red-600 font-normal text-xs">(Company Balance)</span>
                {% else %}
                    <span class="ml-2 text-gray-600 font-normal text-xs">(No Difference)</span>
                {% endif %}

            </td>

            <td colspan="2" class="px-4 py-2 border border-gray-300 text-right">Final Salary Total:</td>
            <td class="px-4 py-2 border border-gray-300 text-green-700 font-bold">рз│ {{ total_final_salary }}</td>
            
            <td class="px-4 py-2 border border-gray-300 text-red-700 font-bold">рз│ {{ total_payable_cash }}</td> <!-- ржлрзБржЯрж╛рж░рзЗ Payable Cash ржЯрзЛржЯрж╛рж▓ -->
        </tr>
    </tfoot>
</table>


</div>
{% else %}
    <p class="text-center text-gray-500 mt-8 font-semibold text-lg">No data found for the selected month.</p>
{% endif %}


{% endblock %}
